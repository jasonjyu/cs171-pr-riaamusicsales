<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>RIAA Music Sales</title>

    <!-- Libraries -->
    <script src="libs/d3/d3.min.js" charset="utf-8"></script>
    <script src="libs/d3/queue.min.js" charset="utf-8"></script>
    <script src="libs/jquery/jquery-2.1.1.min.js" charset="utf-8"></script>
    <script src="libs/bootstrap/js/bootstrap.min.js" charset="utf-8"></script>

    <!-- Stylesheets -->
    <link rel="stylesheet" type="text/css" href="libs/bootstrap/css/bootstrap.min.css">

    <!-- Our JavaScript Files  -->
    <script src="js/dataset.js" type="text/javascript"></script>
    <script src="js/contextVis.js" type="text/javascript"></script>
    <script src="js/focusVis.js" type="text/javascript"></script>
	<script src="js/paraVis.js" type="text/javascript"></script>

    <!-- Our Stylesheets -->
    <link rel="stylesheet" type="text/css" href="css/myStyle.css">
</head>
<body>
    <div class="container">
        <h1>RIAA Music Sales</h1>

        <div id="metricControl"></div><br>

        <div><span class="chartTitle">context overview</span></div>
        <div id="contextVis"></div>

        <div><span class="chartTitle">focus selections</span></div>
        <div id="focusVis1"></div>
		
		<div><span class="chartTitle">parallel coordinates chart</span></div>
        <div id="paraVis"></div>
    </div>

    <script>
        // this function is called after the HTML document is fully loaded
        $(function() {

            // variable keeping global knowledge of the data types in the dataset
            var dataset;

            var bindControlsMetric = function(controlElement, eventHandler,
                eventName) {

                var form = controlElement.append("form")
                    .attr("class", "control")
                    .text("Sales Metric:");

                form.append("label").attr("class", "option").text(
                    "Units ").append("input").attr(
                        {
                            type: "radio",
                            name: "metric",
                            value: "units",
                            checked: "checked"
                        }
                    ).on("click", function() {
                        $(eventHandler).trigger(eventName,
                            [dataset.data_units]);
                    });

                form.append("label").attr("class", "option").text(
                    "Dollars ").append("input").attr(
                        {
                            type: "radio",
                            name: "metric",
                            value: "dollars"
                        }
                    ).on("click", function() {
                        $(eventHandler).trigger(eventName,
                            [dataset.data_dollars]);
                    });

                form.append("label").attr("class", "option").text(
                    "Dollars (inflated) ").append("input").attr(
                        {
                            type: "radio",
                            name: "metric",
                            value: "inflated_dollars"
                        }
                    ).on("click", function() {
                        $(eventHandler).trigger(eventName,
                            [dataset.data_inflatedDollars]);
                    });
            };
			

            // call this function after data is loaded,
            // reformatted and bound to the variables
            var initVis = function() {
                var myEventHandler = new Object();
                var contextVis = new ContextVis(d3.select("#contextVis"),
                    dataset.data_units, myEventHandler);
                var focusVis1 = new FocusVis(d3.select("#focusVis1"),
                    dataset.data_units, dataset.metadata_colorMap,
                    myEventHandler);
				var paraVis = new ParaVis(d3.select("#paraVis"),
                    dataset.data_units, dataset.metadata_colorMap,
                    myEventHandler);

                // bind sales metric controls
                bindControlsMetric(d3.select("#metricControl"), myEventHandler,
                    "dataChanged");
            };

            var startHere = function() {

                // load data here and call parseData() afterwards
                queue()
                    .defer(d3.csv, "data/RIAADATA_units.csv")
                    .defer(d3.csv, "data/RIAADATA_value.csv")
                    .defer(d3.csv, "data/RIAADATA_value_inflation_adjusted.csv")
                    .await(function(error, rows1, rows2, rows3) {
                        // process data if no error occurs
                        if (!error) {
                            dataset = new Dataset(rows1, rows2, rows3);
                            initVis();
                        }
                    });
            };

            startHere();
        });
    </script>
</body>
</html>
